<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculatrice Hypoth√©caire</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, select {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      width: 100%;
    }
    canvas {
      margin-top: 30px;
      max-width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    .flex-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .flex-item {
      flex: 1;
      min-width: 300px;
    }
  </style>
</head>
<body>
  <div class="header">
    <strong>Calculatrice Hypoth√©caire</strong>
  </div>
  <div class="button-container">
    <button class="button" onclick="location.href='outils.html';">‚¨Ö Retour aux outils</button>
  </div>
  <div class="dashboard-section flex-container">
    <div class="section flex-item">
      <form id="formulaire">
        <label for="prix">Prix de la propri√©t√© ($) :</label>
        <input type="number" id="prix" value="400000" required />

        <label for="miseType">Type de mise de fonds :</label>
        <select id="miseType">
          <option value="pourcentage">Pourcentage</option>
          <option value="montant">Montant fixe</option>
        </select>

        <label for="mise">Mise de fonds :</label>
        <input type="number" id="mise" value="20" required />

        <label for="taux">Taux d'int√©r√™t annuel (%) :</label>
        <input type="number" id="taux" value="5" step="0.01" required />

        <label for="frequence">Fr√©quence des paiements :</label>
        <select id="frequence">
          <option value="mensuel">Mensuel</option>
          <option value="bihebdo">Aux deux semaines</option>
          <option value="bihebdo_accelere">Aux deux semaines acc√©l√©r√©</option>
          <option value="hebdo">Hebdomadaire</option>
          <option value="hebdo_accelere">Hebdomadaire acc√©l√©r√©</option>
        </select>

        <label for="amortissement">Dur√©e d'amortissement (ann√©es) :</label>
        <input type="number" id="amortissement" value="25" required />

        <button type="button" class="button" onclick="calculerHypotheque()">Calculer</button>
      </form>

      <div id="resultats" class="resultat"></div>
      <canvas id="graphique"></canvas>
      <div id="tableau"></div>
    </div>

    <div class="section flex-item">
      <h3>üßæ Admissibilit√© hypoth√©caire</h3>
      <form id="form-admissibilite">
        <label for="salaire">Salaire brut annuel ($) :</label>
        <input type="number" id="salaire" value="80000" required />

        <label for="chauffage">Co√ªt de chauffage mensuel ($) :</label>
        <input type="number" id="chauffage" value="150" required />

        <label for="taxes">Taxes fonci√®res mensuelles ($) :</label>
        <input type="number" id="taxes" value="250" required />

        <label for="dettes">Autres dettes mensuelles ($) :</label>
        <input type="number" id="dettes" value="300" required />

        <button type="button" class="button" onclick="verifierAdmissibilite()">V√©rifier</button>
      </form>

      <div id="resultats-admissibilite" class="resultat"></div>
    </div>
  </div>

  <footer>
    üè° 2025 Calculatrice hypoth√©caire | D√©velopp√© par Clement Markus.
  </footer>

  <script>
    let montantPretGlobal = 0;
    let paiementMensuelGlobal = 0;

    function calculerHypotheque() {
      const prix = parseFloat(document.getElementById("prix").value);
      const mise = parseFloat(document.getElementById("mise").value);
      const miseType = document.getElementById("miseType").value;
      const tauxAnnuel = parseFloat(document.getElementById("taux").value) / 100;
      const frequence = document.getElementById("frequence").value;
      const annees = parseInt(document.getElementById("amortissement").value);

      const freqMap = { mensuel: 12, bihebdo: 26, bihebdo_accelere: 26, hebdo: 52, hebdo_accelere: 52 };
      const paiementsParAn = freqMap[frequence];
      const tauxParPeriode = Math.pow(1 + tauxAnnuel, 1 / paiementsParAn) - 1;

      const miseFonds = miseType === "pourcentage" ? prix * (mise / 100) : mise;
      const montantPret = prix - miseFonds;
      const nbPaiements = paiementsParAn * annees;

      const paiement = montantPret * (tauxParPeriode / (1 - Math.pow(1 + tauxParPeriode, -nbPaiements)));
      const coutTotal = paiement * nbPaiements;

      montantPretGlobal = montantPret;
      paiementMensuelGlobal = paiement * (12 / paiementsParAn);

      document.getElementById("resultats").innerHTML = `
        <p>Montant du pr√™t : ${montantPret.toLocaleString()} $</p>
        <p>Paiement ${frequence} : ${paiement.toFixed(2)} $</p>
        <p>Co√ªt total du pr√™t sur ${annees} ans : ${coutTotal.toFixed(2)} $</p>
      `;

      let solde = montantPret;
      const valeurs = [], labels = [];

      for (let i = 0; i <= nbPaiements; i++) {
        if (i % paiementsParAn === 0) {
          valeurs.push(solde);
          labels.push(`Ann√©e ${i / paiementsParAn}`);
        }
        const interet = solde * tauxParPeriode;
        const capital = paiement - interet;
        solde -= capital;
      }

      const ctx = document.getElementById("graphique").getContext("2d");
      if (window.graph) window.graph.destroy();
      window.graph = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Solde du pr√™t',
            data: valeurs,
            borderColor: 'green',
            fill: false
          }]
        }
      });

      let tableau = '<table><tr><th>P√©riode</th><th>Paiement</th><th>Int√©r√™ts</th><th>Capital</th><th>Solde</th></tr>';
      solde = montantPret;
      for (let i = 1; i <= paiementsParAn * 5; i++) {
        const interet = solde * tauxParPeriode;
        const capital = paiement - interet;
        solde -= capital;
        tableau += `<tr><td>${i}</td><td>${paiement.toFixed(2)}</td><td>${interet.toFixed(2)}</td><td>${capital.toFixed(2)}</td><td>${solde.toFixed(2)}</td></tr>`;
      }
      tableau += '</table>';
      document.getElementById("tableau").innerHTML = tableau;
    }

    function verifierAdmissibilite() {
      const salaire = parseFloat(document.getElementById("salaire").value);
      const taux = parseFloat(document.getElementById("taux").value);
      const paiementHypo = paiementMensuelGlobal;
      const chauffage = parseFloat(document.getElementById("chauffage").value);
      const taxes = parseFloat(document.getElementById("taxes").value);
      const dettes = parseFloat(document.getElementById("dettes").value);

      const tauxTest = Math.max(5.25, taux + 2);
      const revenuMensuel = salaire / 12;
      const abd = ((paiementHypo + chauffage + taxes) / revenuMensuel) * 100;
      const atd = ((paiementHypo + chauffage + taxes + dettes) / revenuMensuel) * 100;

      const admissible = abd <= 39 && atd <= 44;
      const montantMaxPret = (revenuMensuel * 0.39 - chauffage - taxes) * 12 * 25;

      document.getElementById("resultats-admissibilite").innerHTML = `
        <p>Taux de qualification utilis√© : ${tauxTest.toFixed(2)} %</p>
        <p>Paiement mensuel estim√© utilis√© : ${paiementHypo.toFixed(2)} $</p>
        <p>Ratio ABD : ${abd.toFixed(2)} %</p>
        <p>Ratio ATD : ${atd.toFixed(2)} %</p>
        <p>${admissible ? '‚úÖ Admissible √† l‚Äôhypoth√®que' : '‚ùå Non admissible √† l‚Äôhypoth√®que'}</p>
        <p>Montant de pr√™t hypoth√©caire maximum estim√© : ${montantMaxPret.toFixed(0)} $</p>
      `;
    }
  </script>
</body>
</html>