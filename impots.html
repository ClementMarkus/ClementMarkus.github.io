<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calcul d'impÃ´t â€” RÃ©sumÃ©</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</head>
<body>
  <div class="header">
    <strong>Calculateur d'impÃ´t</strong>
  </div>
  <div class="container">
    <div class="button-container">
      <button class="button" onclick="location.href='outils.html';">â¬… Retour aux outils</button>
    </div>

    <div class="card">
      <label class="label">Nom du client</label>
      <input id="nom" type="text" placeholder="Ex: Jean Tremblay" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;margin-bottom:12px">

      <label class="label">Revenu imposable ($)</label>
      <input id="revenu" type="number" value="50000" style="width:100%;padding:10px;border-radius:10px;border:1px solid #e8edf7;margin-bottom:12px">
      <button onclick="calculerImpots()" class="button">Calculer</button>
      <button class="button" onclick="telechargerPDF()">ğŸ“„ TÃ©lÃ©charger PDF</button>

      <div class="grid" style="margin-top:18px">
        <div class="card">
          <table class="table-compact">
            <thead><tr><th colspan="2">RÃ©sumÃ©</th></tr></thead>
            <tbody>
              <tr><td class="label">ImpÃ´t sur le revenu</td><td class="value" id="impot-total">â€”</td></tr>
              <tr><td class="label">Revenu net</td><td class="value" id="revenu-net">â€”</td></tr>
            </tbody>
          </table>
        </div>
        <div class="card">
          <table class="table-compact">
            <thead><tr><th colspan="2">Taux d'imposition</th></tr></thead>
            <tbody>
              <tr><td class="label">Taux moyen</td><td class="value" id="taux-moyen">â€”</td></tr>
              <tr><td class="label">Taux marginal</td><td class="value" id="taux-marginal">â€”</td></tr>
              <tr><td class="label">Dividendes dÃ©terminÃ©s</td><td class="value" id="taux-div-det">â€”</td></tr>
              <tr><td class="label">Gains en capital</td><td class="value" id="taux-gc">â€”</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

<script>
const paliersFed=[{min:0,max:16128.99,taux:0},{min:16129,max:57374.99,taux:0.1211},{min:57375,max:114749.99,taux:0.1712},{min:114750,max:177881.99,taux:0.2171},{min:177882,max:253413.99,taux:0.2422},{min:253414,max:Infinity,taux:0.2756}];
const paliersQc=[{min:0,max:18570.99,taux:0},{min:18571,max:53254.99,taux:0.14},{min:53255,max:106494.99,taux:0.19},{min:106495,max:129589.99,taux:0.24},{min:129590,max:Infinity,taux:0.2575}];

function impotProgressif(r,paliers){let imp=0;for(const pl of paliers){if(r>pl.min){const tx=Math.min(r,pl.max)-pl.min;if(tx>0)imp+=tx*pl.taux}}return imp;}
function tauxMarginalCombine(r){return paliersFed.find(p=>r<=p.max).taux+paliersQc.find(p=>r<=p.max).taux;}
const settings={det:{grossUp:1.38,fedCredit:0.1502,qcCredit:0.1170}};

function tauxDividendeTMI(r){const cfg=settings.det,d=1000,gross=d*cfg.grossUp;
  let fB=impotProgressif(r,paliersFed),fA=impotProgressif(r+gross,paliersFed),fNet=Math.max(0,(fA-fB)-gross*cfg.fedCredit);
  let qB=impotProgressif(r,paliersQc),qA=impotProgressif(r+gross,paliersQc),qNet=Math.max(0,(qA-qB)-gross*cfg.qcCredit);
  return((fNet+qNet)/d)*100;
}
function tauxGainEnCapital(r){const d=1000,taxable=d*0.5,b=impotProgressif(r,paliersFed)+impotProgressif(r,paliersQc),
  a=impotProgressif(r+taxable,paliersFed)+impotProgressif(r+taxable,paliersQc);
  return((a-b)/d)*100;
}

function calculerImpots(){
  const r=Number(document.getElementById('revenu').value)||0;
  const f=impotProgressif(r,paliersFed),q=impotProgressif(r,paliersQc),tot=f+q,net=r-tot;
  document.getElementById('impot-total').textContent=tot.toLocaleString(undefined,{maximumFractionDigits:2})+' $';
  document.getElementById('revenu-net').textContent=net.toLocaleString(undefined,{maximumFractionDigits:2})+' $';
  document.getElementById('taux-moyen').textContent=((tot/r)*100).toFixed(2)+' %';
  document.getElementById('taux-marginal').textContent=(tauxMarginalCombine(r)*100).toFixed(2)+' %';
  document.getElementById('taux-div-det').textContent=tauxDividendeTMI(r).toFixed(2)+' %';
  document.getElementById('taux-gc').textContent=tauxGainEnCapital(r).toFixed(2)+' %';
}

function telechargerPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const nom = document.getElementById('nom').value || "â€”";
  const revenu = document.getElementById('revenu').value || "â€”";

  const data = [
    ["ImpÃ´t sur le revenu", document.getElementById('impot-total').textContent],
    ["Revenu net", document.getElementById('revenu-net').textContent],
    ["Taux moyen", document.getElementById('taux-moyen').textContent],
    ["Taux marginal", document.getElementById('taux-marginal').textContent],
    ["Dividendes dÃ©terminÃ©s", document.getElementById('taux-div-det').textContent],
    ["Gains en capital", document.getElementById('taux-gc').textContent]
  ];

  doc.setFontSize(16);
  doc.text("Rapport de calcul d'impÃ´t", 14, 15);
  doc.setFontSize(11);
  doc.text("Date : " + new Date().toLocaleDateString(), 14, 22);
  doc.text("Client : " + nom, 14, 28);
  doc.text("Revenu imposable : " + revenu + " $", 14, 34);

  doc.autoTable({
    startY: 40,
    head: [["DÃ©tail", "Valeur"]],
    body: data,
    styles: { fontSize: 11 },
    headStyles: { fillColor: [11,92,255], textColor: 255 }
  });

  doc.setFontSize(10);
  doc.text("Signature : Clement Markus", 14, doc.lastAutoTable.finalY + 15);
  doc.save("rapport_impot.pdf");
}

calculerImpots();
</script>
</body>
</html>
